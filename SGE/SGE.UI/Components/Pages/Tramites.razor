@page "/tramites/{IdUsuario:Int}"


<PageTitle>Tramite | SGE</PageTitle>
<Excepcion @ref="ventanaExcepcion"/>

<div class="container-lista-tramites">
    <h2> Lista de tramites </h2>
        @* aca tendrian que mostrarse todos los tramites (JAJA no se como hacerlo)*@
</div>

<button id="altaButton">Dar de Alta Tramite</button>
    
    <form id="altaForm" @onsubmit="DarAltaTramite">
        <label for="id">ID:</label>
        <input type="number" id="id" @bind="id" placeholder="Ingrese el ID" required><br>

        <label for="expedienteID">Expediente ID:</label>
        <input type="number" id="expedienteID" @bind="expedienteID" placeholder="Ingrese el Expediente ID" required><br>

        <label for="contenido">Contenido:</label>
        <input type="text" id="contenido" @bind="contenido" placeholder="Ingrese el Contenido" required><br>

        <label for="idUsuario">ID Usuario:</label>
        <input type="number" id="idUsuario" @bind="idUsuario" placeholder="Ingrese el ID Usuario" required><br>

        <label for="etiqueta">Etiqueta:</label>
        <select id="etiqueta" @bind="etiqueta" required>
            <option value="EscritoPresentado">Escrito presentado</option>
            <option value="Despacho">Despacho</option>
            <option value="Notificacion">Notificacion</option>
            <option value="Resolucion">Resolución</option>
            <option value="PaseAEstudio">Pase a Estudio</option>
            <option value="PaseAlArchivo">Pase al Archivo</option>
        </select><br>

        <button type="enviar-tramite-alta-button">Enviar</button>
    </form>

@code {
    // @using global::SGE.Repositorios  PUEDE QUE ESTO ESTE RE MAL linea 2
    private int expedienteID;
    private int id;
    private string? contenido;
    private int idUsuario;
    private string? etiqueta; 
    Excepcion ventanaExcepcion = null!;
    private void DarAltaTramite(){ 
        
        //Copie ejecutar de registrar usuario
        IExpedienteRepositorio repositorioExpedientes = new RepositorioExpedienteSQLite();
        ITramiteRepositorio repositorioTramites = new RepositorioTramiteSQLite();
        IUsuarioRepositorio repoUsuarios = new RepositorioUsuarioSQLite();
        ServicioAutorizacion autorizacion = new ServicioAutorizacion(repoUsuarios);
        ServicioActualizacionEstado actualizacion = new ServicioActualizacionEstado(repositorioExpedientes, repositorioTramites);
        CasoDeUsoTramiteAlta registro = new CasoDeUsoTramiteAlta(repositorioTramites, autorizacion, actualizacion); 

        try{
            registro.Ejecutar(expedienteID, contenido, etiqueta, idUsuario); //Por que pide tramite? habria que mandar los datos de forma campo a campo. ¿Como le mando la id de usuario?
        }
        catch(RepositorioException ex){
            ventanaExcepcion.Mensaje = $"{ex.Message}";
            ventanaExcepcion.Mostrar();
        }
    }
}